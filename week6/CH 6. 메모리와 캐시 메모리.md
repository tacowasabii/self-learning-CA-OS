# CH 6. 메모리와 캐시 메모리

## 6-1 RAM의 특징과 종류

### RAM의 특징

RAM에는 실행할 프로그램의 명령어와 데이터가 저장된다. 중요한 점은 전원을 끄면 RAM에 저장된 명령어와 데이터가 모두 날아간다. 이렇게 전원을 끄면 저장된 내용이 사라지는 저장 장치를 **휘발성 저장 장치**라고 한다.

반면, 전원이 꺼져도 저장된 내용이 유지되는 저장 장치는 **비휘발성 저장 장치**라고 한다. 하드 디스크나 SSD, CD-ROM, USB 메모리와 같은 보조기억장치가 대표적인 비휘발성 저장 장치다.

보조기억장치는 전원을 꺼도 내용을 유지하지만, CPU는 보조기억장치에 직접 접근하지 못한다. 그래서 일반적으로 보조기억장치인 비휘발성 저장 장치에는 '보관할 대상'을 저장하고, 휘발성 저장 장치인 RAM에는 '실행할 대상'을 저장한다. CPU가 실행하고 싶은 프로그램이 보조기억장치에 있다면 이를 RAM으로 복사하여 저장한 뒤 실행한다.

### RAM의 용량과 성능

CPU가 실행하고 싶은 프로그램이 보조기억장치에 있다면 이를 RAM으로 가져와야 할 텐데, RAM 용량이 적다면 보조기억장치에서 실행할 프로그램을 가져오는 일이 잦아 실행 시간이 길어진다. RAM 용량이 크면 많은 프로그램들을 동시에 빠르게 실행하는 데 유리하다.

### RAM의 종류

#### DRAM

**DRAM**은 Dynamic RAM의 준말이다. DRAM은 시간이 지나면 저장된 데이터가 점차 사라지는 RAM이다. 그렇기에 DRAM은 데이터의 소멸을 막기 위해 일정 주기로 데이터를 재활성화(다시 저장)해야 한다.

이런 단점에도 불구하고 우리가 일반적으로 메모리로써 사용하는 RAM은 DRAM이다. 소비 전력이 비교적 낮고, 저렴하고, 집적도가 높기 때문에 대용량으로 설계하기가 용이하기 때문이다.

#### SRAM

**SRAM** static RAM의 준말이다. DRAM과는 달리 SRAM은 시간이 지나도 저장된 데이터가 사라지지 않는다. 그리고 DRAM보다 일반적으로 속도도 더 빠르다.

하지만 SRAM은 DRAM보다 집적도가 낮고, 소비 전력도 크며, 가격도 더 비싸다. 그래서 SRAM은 메모리가 아닌 '대용량으로 만들어질 필요는 없지만 속도가 빨라야 하는 저장 장치', 가려 캐시 메모리에서 사용된다.

#### SDRAM

**SDRAM**은 클럭 신호와 동기화된, 발전된 형태의 DRAM이다. '클럭 신호와 동기화되었다'는 말은 클럭 타이밍에 맞춰 CPU와 정보를 주고받을 수 있음을 의미한다. 즉, SDRAM은 클럭에 맞춰 동작하며 클럭마다 CPU와 정보를 주고받을 수 있는 DRAM이다.

#### DDR SDRAM(Double Data Rate SDRAM)

**DDR SDRAM**은 최근 가장 흔히 사용되는 RAM이다. DDR SDRAM은 대역폭을 넓혀 속도를 빠르게 만든 SDRAM이다. 여기서 대역폭이란 '데이터를 주고받는 길의 너비'를 의미한다.

한 클럭에 한 번씩 CPU와 데이터를 주고받을 수 있는 SDRAM에 비해 DDR SDRAM은 두 배의 대역폭으로 한 클럭당 두 번씩 CPU와 데이터를 주고받을 수 있어 전송 속도가 두 배가량 빠르다. 이런 이유로 SDRAM을 **SDR SDRAM**이라 부르기도 한다.

최근에 흔히 사용하는 메모리는 DDR4 SDRAM으로, SDR SDRAM보다 16배 넓은 대역폭을 가진다.

## 6-2 메모리의 주소 공간

### 물리 주소와 논리 주소

주소에는 **물리 주소**와 **논리 주소** 두 종류가 있다. 물리 주소는 메모리 하드웨어가 사용하는 주소이고, 논리 주소는 CPU와 실행 중인 프로그램이 사용하는 주소이다. 메모리가 사용하는 물리 주소는 말 그대로 정보가 실제로 저장된 하드웨어상의 주소를 의미한다. 반면 논리 주소는 실행 중인 프로그램 각각에게 부여된 0번지부터 시작되는 주소를 의미한다.

실행 중인 프로그램들은 다른 프로그램들의 물리 주소를 알 필요가 없기 때문에 자신만을 위한 논리 주소를 갖는다. 따라서 프로그램마다 같은 논리 주소가 얼마든지 있을 수 있다. 그리고 CPU는 이 논리 주소를 받아들이고, 해석하고, 연산한다.

논리 주소와 물리 주소 간의 변환은 CPU와 주소 버스 사이에 위치한 **메모리 관리 장치(Memory Management Unit: MMU)**라는 하드웨어에 의해 수행된다. MMU는 CPU가 발생시킨 논리 주소에 베이스 레지스터 값을 더하여 논리 주소를 물리 주소로 변환한다.

**베이스 레지스터**는 프로그램의 가장 작은 물리 주소, 즉 프로그램의 첫 물리 주소를 저장하는 셈이고, **논리 주소**는 프로그램의 시작점으로부터 떨어진 거리인 셈이다.

### 메모리 보호 기법

논리 주소 영역을 벗어난 명령어 실행을 방지하고 실행 중인 프로그램이 다른 프로그램에 영향을 받지 않도록 보호할 방법이 필요한다. 이는 **한계 레지스터**가 담당한다. 베이스 레지스터가 실행 중인 프로그램의 가장 작은 물리 주소를 저장한다면, 한계 레지스터는 논리 주소의 최대 크기를 저장한다. 즉, 프로그램의 물리 주소 범위는 베이스 레지스터 값 이상, 베이스 레지스터 값 + 한계 레지스터 값 미만이 된다.

CPU는 메모리에 접근하기 전에 접근하고자 하는 논리 주소가 한계 레지스터보다 작은지를 항상 검사한다. 만약 CPU가 한계 레지스터보다 높은 논리 주소에 접근하려고 하면 인터럽트(트랩)를 발생시켜 실행을 중단한다.

## 6-3 캐시 메모리

### 저장 장치 계층 구조

저장 장치는 일반적으로 아래와 같은 명제를 따른다.

1. CPU와 가까운 저장 장치는 빠르고, 멀리 있는 저장 장치는 느리다.
2. 속도가 빠른 저장 장치는 저장 용량이 작고, 가격이 비싸다.

위와 같은 이유로 저장 장치들은 각각 장단점이 명확하기 때문에 컴퓨터는 다양한 저장 장치를 모두 사용한다. 컴퓨터가 사용하는 저장 장치들은 'CPU에 얼마나 가까운가'를 기준으로 계층적으로 나타낼 수 있다. 이를 **저장 장치 계층 구조**라고 한다. CPU에 가까운 저장 장치일수록 빠르고, 용량이 작고, 빘다.

### 캐시 메모리

CPU는 프로그램을 실행하는 과정에서 메모리에 저장된 데이터를 빈번하게 사용한다. 하지만 CPU가 메모리에 접근하는 시간은 CPU의 연산 속도보다 느리다. 이를 극복하기 위한 저장 장치가 **캐시 메모리**이다. 캐시 메모리는 CPU와 메모리 사이에 위치하고, 레지스터보다 용량이 크고 메모리보다 빠른 SRAM 기반의 저장 장치이다.

컴퓨터 내부에는 여러 개의 캐시 메모리가 있다. 그리고 이 캐시 메모리들은 CPU(코어)와 가까운 순서대로 계층을 구성한다. 코어와 가까운 메모리 순으로 **L1 캐시, L2 캐시, L3 캐시**라고 부른다. 캐시 메모리의 용량은 L1, L2, L3 순으로 커지고, 속도는 L3, L2, L1 순으로 빨라지고, 가격은 L3, L2, L1 순으로 비싸진다. CPU가 메모리 내에 데이터가 필요하다고 판단하면 우선 L1 캐시에 해당 데이터가 있는지를 알아보고, 없다면 L2, L3 캐시 순으로 데이터를 검색한다.

멀티 프로세서에서 L1 캐시와 L2 캐시는 코어마다 고유한 캐시 메모리로 할당되고, L3 캐시는 여러 코어가 공유하는 형태로 사용된다.

### 참조 지역성 원리

캐시 메모리는 메모리의 일부를 복사하여 저장한다. 보조기억장치는 전원이 꺼져도 기억할 대상을 저장하고, 메모리는 실행 중인 대상을 저장한다면 캐시 메모리는 CPU가 사용할 법한 대상을 예측하여 저장한다. 이때 자주 사용될 것으로 예측한 데이터가 실제로 들어맞아 캐시 메모리 내 데이터가 CPU에서 활용될 경우를 **캐시 히트**라고 한다. 반대로 예측이 틀려 메모리에서 필요한 데이터를 직접 가져와야 하는 경우를 **캐시 미스**라고 한다.

캐시가 히트되는 비율을 **캐시 적중률**이라 하고 다음과 같이 계산한다.

```
캐시 히트 횟수 / (캐시 히트 횟수 + 캐시 미스 횟수)
```

캐시 메모리는 **참조 지역성의 원리**에 따라 메모리부터 가져올 데이터를 결정한다. 참조 지역성의 원리란 CPU가 메모리에 접근할 때의 주된 경향을 바탕으로 만들어진 원리이다.

1. CPU는 최근에 접근했던 메모리 공간에 다시 접근하려는 경향이 있다. - **시간 지역성**
2. CPU는 접근한 메모리 공간 근처를 접근하려는 경향이 있다. - **공간 지역성**
